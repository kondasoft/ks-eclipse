<div 
  id="contact-form-{{ section.id }}"
  class="contact-form section-styling section-spacing"
  style="
    --pt: {{ section.settings.pt }};
    --pb: {{ section.settings.pb }};
  "
  {% if section.settings.custom_color_schemes %}
    data-light-color-scheme="{{ section.settings.light_color_scheme }}"
    data-dark-color-scheme="{{ section.settings.dark_color_scheme }}"
  {% endif %}
>
  <div 
    class="container"
    style="--container-max-width: {{ section.settings.container_max_width | append: 'px' }}; "
  >
    <header class="section-header text-{{ section.settings.header_align }}">
      {% if section.settings.heading != blank %}
        <h2 class="{{ section.settings.heading_size }}">
          {{ section.settings.heading }}
        </h2>
      {% endif %}
      {% if section.settings.description != blank %}
        <div class="description rte {{ section.settings.description_size }}">
          {{ section.settings.description }}
        </div>
      {% endif %}
    </header>
    {% form 'contact', class: 'contact-form-fields' %}
      {% if form.posted_successfully? %}
        <div 
          class="alert alert-success" 
          role="status"
          tabindex="-1">
          <p>{{ 'general.contact_form.success' | t }}</p>
        </div>
      {% elsif form.errors %}
        <div 
          class="alert alert-error" 
          role="alert" 
          tabindex="-1">
          <p>{{ 'general.contact_form.error' | t }}</p>
          <ul>
            {% for field in form.errors %}
              <li>
                {% if field == 'form' %}
                  {{ form.errors.messages[field] }}
                {% else %}
                  {{ form.errors.translated_fields[field] | capitalize }} {{ form.errors.messages[field] }}
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}
      <div class="form-group">
        <label 
          for="contact-form-name-{{ section.id }}">
          {{ 'general.contact_form.name' | t }}
          <span class="required alert-error" aria-hidden="true">*</span>
        </label>
        <input
          id="contact-form-name-{{ section.id }}"
          class="input"
          type="text"
          name="contact[name]"
          value="{% if form.name %}{{ form.name | escape }}{% elsif customer %}{{ customer.name | escape }}{% endif %}"
          autocomplete="name"
          autocorrect="off"
          autocapitalize="words"
          spellcheck="false"
          required
          aria-required="true"
          aria-invalid="{% if form.errors contains 'name' %}true{% else %}false{% endif %}"
          {% if form.errors contains 'name' %}
            aria-describedby="contact-form-name-error-{{ section.id }}"
          {% endif %}
        >
        {% if form.errors contains 'name' %}
          <small id="contact-form-name-error-{{ section.id }}" class="visually-hidden">
            {{ form.errors.translated_fields.name | capitalize }} {{ form.errors.messages.name }}
          </small>
        {% endif %}
      </div>
      <div class="form-group">
        <label for="contact-form-email-{{ section.id }}">
          {{ 'general.contact_form.email' | t }}
          <span class="required alert-error" aria-hidden="true">*</span>
        </label>
        <input
          id="contact-form-email-{{ section.id }}"
          class="input"
          type="text"
          name="contact[email]"
          value="{% if form.email %}{{ form.email | escape }}{% elsif customer %}{{ customer.email | escape }}{% endif %}"
          autocomplete="email"
          autocorrect="off"
          autocapitalize="off"
          spellcheck="false"
          required
          aria-required="true"
          aria-invalid="{% if form.errors contains 'email' %}true{% else %}false{% endif %}"
          {% if form.errors contains 'email' %}
            aria-describedby="contact-form-email-error-{{ section.id }}"
          {% endif %}
        >
        {% if form.errors contains 'email' %}
          <small id="contact-form-email-error-{{ section.id }}" class="visually-hidden">
            {{ form.errors.translated_fields.email | capitalize }} {{ form.errors.messages.email }}
          </small>
        {% endif %}
      </div>
      {% if section.settings.show_phone %}
        <div class="form-group">
          <label for="contact-form-phone-{{ section.id }}">
            {{ 'general.contact_form.phone' | t }}
          </label>
          <input
            id="contact-form-phone-{{ section.id }}"
            class="input"
            type="tel"
            name="contact[phone]"
            value="{% if form.phone %}{{ form.phone | escape }}{% elsif customer %}{{ customer.phone | escape }}{% endif %}"
            autocomplete="tel"
            autocorrect="off"
            autocapitalize="off"
            spellcheck="false"
            pattern="[0-9\-\+\s\(\)]*"
          >
        </div>
      {% endif %}
      <div class="form-group">
        <label for="contact-form-message-{{ section.id }}">
          {{ 'general.contact_form.message' | t }}
          <span class="required alert-error" aria-hidden="true">*</span>
        </label>
        <textarea
          id="contact-form-message-{{ section.id }}"
          class="input"
          name="contact[body]"
          rows="8"
          required
          aria-required="true"
          aria-invalid="{% if form.errors contains 'body' %}true{% else %}false{% endif %}"
          {% if form.errors contains 'body' %}
            aria-describedby="contact-form-message-error-{{ section.id }}"
          {% endif %}
        >{{ form.body | escape }}</textarea>
        {% if form.errors contains 'body' %}
          <small id="contact-form-message-error-{{ section.id }}" class="visually-hidden">
            {{ form.errors.translated_fields.body | capitalize }} {{ form.errors.messages.body }}
          </small>
        {% endif %}
      </div>
      <button
        type="submit"
        class="btn btn-primary btn-full {{ section.settings.btn_size }}"
      >
        {{ 'general.contact_form.submit' | t }}
      </button>
    {% endform %}
  </div>
</div>

<script>
  (() => {
    const section = document.getElementById('contact-form-{{ section.id }}');
    if (!section) return;

    const alert = section.querySelector('.alert[tabindex="-1"]');
    if (!alert) return;

    requestAnimationFrame(() => {
      alert.focus();
    });
  })();
</script>

{% schema %}
{
  "name": "Contact form",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "checkbox",
      "id": "custom_color_schemes",
      "label": "Custom color schemes",
      "default": false
    },
    {
      "type": "color_scheme",
      "id": "light_color_scheme",
      "label": "Light color scheme",
      "default": "scheme-1",
      "visible_if": "{{ section.settings.custom_color_schemes == true }}"
    },
    {
      "type": "color_scheme",
      "id": "dark_color_scheme",
      "label": "Dark color scheme",
      "default": "scheme-3",
      "visible_if": "{{ section.settings.custom_color_schemes == true }}"
    },
    {
      "type": "range",
      "id": "container_max_width",
      "label": "Container width",
      "min": 500,
      "max": 1200,
      "step": 50,
      "default": 600,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "Header"
    },
    {
      "type": "text_alignment",
      "id": "header_align",
      "label": "Header alignment",
      "default": "center"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Contact us"
    },
    {
      "type": "select",
      "id": "heading_size",
      "label": "Heading size",
      "default": "h2",
      "options": [
        { "value": "h1", "label": "H1" },
        { "value": "h2", "label": "H2" },
        { "value": "h3", "label": "H3" },
        { "value": "h4", "label": "H4" },
        { "value": "h5", "label": "H5" },
        { "value": "h6", "label": "H6" }
      ]
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description",
      "default": "<p>Send us a message and we will get back to you as soon as possible.</p>"
    },
    {
      "type": "select",
      "id": "description_size",
      "label": "Description size",
      "default": "fs-md",
      "options": [
        { "value": "fs-sm", "label": "Small" },
        { "value": "fs-md", "label": "Medium" },
        { "value": "fs-lg", "label": "Large" }
      ]
    },
    {
      "type": "header",
      "content": "Form"
    },
    {
      "type": "checkbox",
      "id": "show_phone",
      "label": "Show phone field",
      "default": false
    },
    {
      "type": "select",
      "id": "btn_size",
      "label": "Button size",
      "default": "fs-md",
      "options": [
        { "value": "fs-md", "label": "Medium" },
        { "value": "fs-lg", "label": "Large" }
      ]
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "pt",
      "label": "Top",
      "min": 0,
      "max": 50,
      "step": 1,
      "default": 20
    },
    {
      "type": "range",
      "id": "pb",
      "label": "Bottom",
      "min": 0,
      "max": 50,
      "step": 1,
      "default": 20
    }
  ],
  "presets": [
    {
      "name": "Contact form",
      "category": "Other"
    }
  ]
}
{% endschema %}
