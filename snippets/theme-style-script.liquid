{% style %}
  {% liquid 
    unless settings.font_headings.system?
    echo settings.font_headings | font_face: font_display: 'swap'
    endunless

    unless settings.font_body.system?
      echo settings.font_body | font_face: font_display: 'swap'
      echo settings.font_body | font_modify: 'weight', '700' | font_face: font_display: 'swap'
    endunless
  %}

  :root[data-theme="light"] {
    {%- for scheme in settings.color_schemes -%}
      {% if scheme.id contains settings.light_color_scheme %}
        --color-background: {{ scheme.settings.background.red }} {{ scheme.settings.background.green }} {{ scheme.settings.background.blue }};
        {% if scheme.settings.background_gradient != empty -%}
          --color-background-gradient: {{ scheme.settings.background_gradient }};
        {%- endif -%}
        --color-foreground: {{ scheme.settings.foreground.red }} {{ scheme.settings.foreground.green }} {{ scheme.settings.foreground.blue }};
        --color-accent: {{ scheme.settings.accent.red }} {{ scheme.settings.accent.green }} {{ scheme.settings.accent.blue }};
        --color-btn-primary-background: {{ scheme.settings.btn_primary_background.red }} {{ scheme.settings.btn_primary_background.green }} {{ scheme.settings.btn_primary_background.blue }};
        --color-btn-primary-background-opacity: {{ scheme.settings.btn_primary_background.alpha }};
        --color-btn-primary-foreground: {{ scheme.settings.btn_primary_foreground.red }} {{ scheme.settings.btn_primary_foreground.green }} {{ scheme.settings.btn_primary_foreground.blue }};
        --color-btn-primary-border: {{ scheme.settings.btn_primary_border.red }} {{ scheme.settings.btn_primary_border.green }} {{ scheme.settings.btn_primary_border.blue }};
        --color-btn-secondary-background: {{ scheme.settings.btn_secondary_background.red }} {{ scheme.settings.btn_secondary_background.green }} {{ scheme.settings.btn_secondary_background.blue }};
        --color-btn-secondary-background-opacity: {{ scheme.settings.btn_secondary_background.alpha }};
        --color-btn-secondary-foreground: {{ scheme.settings.btn_secondary_foreground.red }} {{ scheme.settings.btn_secondary_foreground.green }} {{ scheme.settings.btn_secondary_foreground.blue }};
        --color-btn-secondary-border: {{ scheme.settings.btn_secondary_border.red }} {{ scheme.settings.btn_secondary_border.green }} {{ scheme.settings.btn_secondary_border.blue }};    
      {%- endif %}
    {%- endfor -%}
  }

  :root[data-theme="dark"] {
    {%- for scheme in settings.color_schemes -%}
      {% if scheme.id contains settings.dark_color_scheme %}
        --color-background: {{ scheme.settings.background.red }} {{ scheme.settings.background.green }} {{ scheme.settings.background.blue }};
        {% if scheme.settings.background_gradient != empty -%}
          --color-background-gradient: {{ scheme.settings.background_gradient }};
        {%- endif -%}
        --color-foreground: {{ scheme.settings.foreground.red }} {{ scheme.settings.foreground.green }} {{ scheme.settings.foreground.blue }};
        --color-accent: {{ scheme.settings.accent.red }} {{ scheme.settings.accent.green }} {{ scheme.settings.accent.blue }};
        --color-btn-primary-background: {{ scheme.settings.btn_primary_background.red }} {{ scheme.settings.btn_primary_background.green }} {{ scheme.settings.btn_primary_background.blue }};
        --color-btn-primary-background-opacity: {{ scheme.settings.btn_primary_background.alpha }};
        --color-btn-primary-foreground: {{ scheme.settings.btn_primary_foreground.red }} {{ scheme.settings.btn_primary_foreground.green }} {{ scheme.settings.btn_primary_foreground.blue }};
        --color-btn-primary-border: {{ scheme.settings.btn_primary_border.red }} {{ scheme.settings.btn_primary_border.green }} {{ scheme.settings.btn_primary_border.blue }};
        --color-btn-secondary-background: {{ scheme.settings.btn_secondary_background.red }} {{ scheme.settings.btn_secondary_background.green }} {{ scheme.settings.btn_secondary_background.blue }};
        --color-btn-secondary-background-opacity: {{ scheme.settings.btn_secondary_background.alpha }};
        --color-btn-secondary-foreground: {{ scheme.settings.btn_secondary_foreground.red }} {{ scheme.settings.btn_secondary_foreground.green }} {{ scheme.settings.btn_secondary_foreground.blue }};
        --color-btn-secondary-border: {{ scheme.settings.btn_secondary_border.red }} {{ scheme.settings.btn_secondary_border.green }} {{ scheme.settings.btn_secondary_border.blue }};    
      {%- endif %}
    {%- endfor -%}
  }

  {% for scheme in settings.color_schemes %}
    [data-color-scheme="{{ scheme.id }}"] {
      --color-background: {{ scheme.settings.background.red }} {{ scheme.settings.background.green }} {{ scheme.settings.background.blue }};
      {% if scheme.settings.background_gradient != empty -%}
        --color-background-gradient: {{ scheme.settings.background_gradient }};
      {%- endif -%}
      --color-foreground: {{ scheme.settings.foreground.red }} {{ scheme.settings.foreground.green }} {{ scheme.settings.foreground.blue }};
      --color-accent: {{ scheme.settings.accent.red }} {{ scheme.settings.accent.green }} {{ scheme.settings.accent.blue }};
      --color-btn-primary-background: {{ scheme.settings.btn_primary_background.red }} {{ scheme.settings.btn_primary_background.green }} {{ scheme.settings.btn_primary_background.blue }};
      --color-btn-primary-background-opacity: {{ scheme.settings.btn_primary_background.alpha }};
      --color-btn-primary-foreground: {{ scheme.settings.btn_primary_foreground.red }} {{ scheme.settings.btn_primary_foreground.green }} {{ scheme.settings.btn_primary_foreground.blue }};
      --color-btn-primary-border: {{ scheme.settings.btn_primary_border.red }} {{ scheme.settings.btn_primary_border.green }} {{ scheme.settings.btn_primary_border.blue }};
      --color-btn-secondary-background: {{ scheme.settings.btn_secondary_background.red }} {{ scheme.settings.btn_secondary_background.green }} {{ scheme.settings.btn_secondary_background.blue }};
      --color-btn-secondary-background-opacity: {{ scheme.settings.btn_secondary_background.alpha }};
      --color-btn-secondary-foreground: {{ scheme.settings.btn_secondary_foreground.red }} {{ scheme.settings.btn_secondary_foreground.green }} {{ scheme.settings.btn_secondary_foreground.blue }};
      --color-btn-secondary-border: {{ scheme.settings.btn_secondary_border.red }} {{ scheme.settings.btn_secondary_border.green }} {{ scheme.settings.btn_secondary_border.blue }};
    }
    :root[data-theme="light"] [data-light-color-scheme="{{ scheme.id }}"] {
      --color-background: {{ scheme.settings.background.red }} {{ scheme.settings.background.green }} {{ scheme.settings.background.blue }};
      {% if scheme.settings.background_gradient != empty -%}
        --color-background-gradient: {{ scheme.settings.background_gradient }};
      {%- endif -%}
      --color-foreground: {{ scheme.settings.foreground.red }} {{ scheme.settings.foreground.green }} {{ scheme.settings.foreground.blue }};
      --color-accent: {{ scheme.settings.accent.red }} {{ scheme.settings.accent.green }} {{ scheme.settings.accent.blue }};
      --color-btn-primary-background: {{ scheme.settings.btn_primary_background.red }} {{ scheme.settings.btn_primary_background.green }} {{ scheme.settings.btn_primary_background.blue }};
      --color-btn-primary-background-opacity: {{ scheme.settings.btn_primary_background.alpha }};
      --color-btn-primary-foreground: {{ scheme.settings.btn_primary_foreground.red }} {{ scheme.settings.btn_primary_foreground.green }} {{ scheme.settings.btn_primary_foreground.blue }};
      --color-btn-primary-border: {{ scheme.settings.btn_primary_border.red }} {{ scheme.settings.btn_primary_border.green }} {{ scheme.settings.btn_primary_border.blue }};
      --color-btn-secondary-background: {{ scheme.settings.btn_secondary_background.red }} {{ scheme.settings.btn_secondary_background.green }} {{ scheme.settings.btn_secondary_background.blue }};
      --color-btn-secondary-background-opacity: {{ scheme.settings.btn_secondary_background.alpha }};
      --color-btn-secondary-foreground: {{ scheme.settings.btn_secondary_foreground.red }} {{ scheme.settings.btn_secondary_foreground.green }} {{ scheme.settings.btn_secondary_foreground.blue }};
      --color-btn-secondary-border: {{ scheme.settings.btn_secondary_border.red }} {{ scheme.settings.btn_secondary_border.green }} {{ scheme.settings.btn_secondary_border.blue }};
    }
    :root[data-theme="dark"] [data-dark-color-scheme="{{ scheme.id }}"] {
      --color-background: {{ scheme.settings.background.red }} {{ scheme.settings.background.green }} {{ scheme.settings.background.blue }};
      {% if scheme.settings.background_gradient != empty -%}
        --color-background-gradient: {{ scheme.settings.background_gradient }};
      {%- endif -%}
      --color-foreground: {{ scheme.settings.foreground.red }} {{ scheme.settings.foreground.green }} {{ scheme.settings.foreground.blue }};
      --color-accent: {{ scheme.settings.accent.red }} {{ scheme.settings.accent.green }} {{ scheme.settings.accent.blue }};
      --color-btn-primary-background: {{ scheme.settings.btn_primary_background.red }} {{ scheme.settings.btn_primary_background.green }} {{ scheme.settings.btn_primary_background.blue }};
      --color-btn-primary-background-opacity: {{ scheme.settings.btn_primary_background.alpha }};
      --color-btn-primary-foreground: {{ scheme.settings.btn_primary_foreground.red }} {{ scheme.settings.btn_primary_foreground.green }} {{ scheme.settings.btn_primary_foreground.blue }};
      --color-btn-primary-border: {{ scheme.settings.btn_primary_border.red }} {{ scheme.settings.btn_primary_border.green }} {{ scheme.settings.btn_primary_border.blue }};
      --color-btn-secondary-background: {{ scheme.settings.btn_secondary_background.red }} {{ scheme.settings.btn_secondary_background.green }} {{ scheme.settings.btn_secondary_background.blue }};
      --color-btn-secondary-background-opacity: {{ scheme.settings.btn_secondary_background.alpha }};
      --color-btn-secondary-foreground: {{ scheme.settings.btn_secondary_foreground.red }} {{ scheme.settings.btn_secondary_foreground.green }} {{ scheme.settings.btn_secondary_foreground.blue }};
      --color-btn-secondary-border: {{ scheme.settings.btn_secondary_border.red }} {{ scheme.settings.btn_secondary_border.green }} {{ scheme.settings.btn_secondary_border.blue }};
    }
  {% endfor %}

  :root {
    --font-headings-family: {{ settings.font_headings.family }}, {{ settings.font_headings.fallback_families }};
    --font-headings-weight: {{ settings.font_headings.weight }};
    --font-body-family: {{ settings.font_body.family }}, {{ settings.font_body.fallback_families }}; 
    --font-body-weight: {{ settings.font_body.weight }};
    --body-base-size: {{ settings.body_base_size | divided_by: 100.0 | append: 'rem' }};
    --headings-base-size: {{ settings.headings_base_size | divided_by: 100.0 | append: 'rem' }};
    --letter-spacing: {{ settings.letter_spacing | divided_by: 100.0 | append: 'em' }};
    --container-max-width: {{ settings.container_max_width | append: 'px' }};
    --border-radius: {{ settings.border_radius | append: 'rem' }};
    --border-opacity: {{ settings.border_opacity | append: '%' }};
  }
{% endstyle %}

<script>
  function applyInitialTheme() {
    let defaultTheme = '{{ settings.default_theme }}';
    let theme = defaultTheme;
    let savedTheme = null;

    try {
      savedTheme = localStorage.getItem('theme');
    } catch (error) {
      savedTheme = null;
    }

    if (savedTheme === 'light' || savedTheme === 'dark' || savedTheme === 'system') {
      theme = savedTheme;
    }

    if (theme === 'system') {
      theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }

    document.documentElement.setAttribute('data-theme', theme);
  }

  applyInitialTheme();
</script>
